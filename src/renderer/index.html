<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Vash Reader</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app">
        <header class="header">
            <h1 id="homeTitle" class="clickable-title">Vash Reader</h1>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search manga or click to browse...">
                <button id="searchBtn">Search</button>
                <button id="advancedSearchBtn" class="advanced-search-btn">üîç Advanced</button>
            </div>
            <div class="header-buttons">
                <button id="followsBtn" class="header-btn">Following</button>
                <button id="notificationsBtn" class="header-btn notification-btn">
                    üîî
                    <span id="notificationBadge" class="notification-badge hidden">0</span>
                </button>
                <button id="settingsBtn" class="header-btn" title="Settings">‚öôÔ∏è</button>
                <button id="filterToggleBtn" class="filter-toggle enabled" title="Toggle content filter">üîû
                    Filter</button>
            </div>
        </header>

        <main class="main">
            <div id="homePage" class="home-page">
                <!-- Last Read Section -->
                <section class="home-section" id="lastReadSection">
                    <div class="section-header">
                        <h2>Last Read</h2>
                        <div class="section-nav">
                            <button id="lastReadPrev" class="nav-btn">‚Üê</button>
                            <button id="lastReadNext" class="nav-btn">‚Üí</button>
                        </div>
                    </div>
                    <div id="lastReadGrid" class="horizontal-grid"></div>
                </section>

                <!-- Following Chapter Updates Section -->
                <section class="home-section" id="followingUpdatesSection">
                    <div class="section-header">
                        <h2>Following Chapter Updates</h2>
                        <div class="section-nav">
                            <button id="followingUpdatesPrev" class="nav-btn">‚Üê</button>
                            <button id="followingUpdatesNext" class="nav-btn">‚Üí</button>
                        </div>
                    </div>
                    <div id="followingUpdatesGrid" class="horizontal-grid"></div>
                </section>

                <!-- Popular Ongoing Section -->
                <section class="home-section">
                    <div class="section-header">
                        <h2>Popular Ongoing</h2>
                        <div class="section-nav">
                            <button id="popularPrev" class="nav-btn">‚Üê</button>
                            <button id="popularNext" class="nav-btn">‚Üí</button>
                        </div>
                    </div>
                    <div id="popularGrid" class="horizontal-grid"></div>
                </section>

                <!-- Trending Section -->
                <section class="home-section">
                    <div class="section-header">
                        <h2>Most Recent Popular</h2>
                        <div class="section-nav">
                            <button id="trendingPrev" class="nav-btn">‚Üê</button>
                            <button id="trendingNext" class="nav-btn">‚Üí</button>
                        </div>
                    </div>
                    <div id="trendingGrid" class="horizontal-grid"></div>
                </section>

                <!-- New Follow Section -->
                <section class="home-section">
                    <div class="section-header">
                        <h2>Most Followed New Comics</h2>
                        <div class="section-nav">
                            <button id="newFollowPrev" class="nav-btn">‚Üê</button>
                            <button id="newFollowNext" class="nav-btn">‚Üí</button>
                        </div>
                    </div>
                    <div id="newFollowGrid" class="horizontal-grid"></div>
                </section>

                <!-- Recent Updates Section -->
                <section class="home-section">
                    <h2>Recent Updates</h2>
                    <div id="recentGrid" class="recent-grid"></div>
                </section>
            </div>

            <div id="searchResults" class="search-results hidden">
                <h2>Search Results</h2>
                <div id="resultsGrid" class="results-grid"></div>
            </div>

            <!-- Manga Details Page -->
            <div id="mangaDetails" class="manga-details hidden">
                <button id="backToSearchResults" class="back-btn">‚Üê Back</button>
                <div class="manga-details-content">
                    <div class="manga-info-header">
                        <div class="manga-cover-section">
                            <img id="mangaCoverImage" class="manga-details-cover" alt="Manga Cover">
                            <div class="manga-rating">
                                <span class="rating-label">Rating:</span>
                                <span id="mangaRating" class="rating-value">N/A</span>
                                <span class="rating-stars" id="mangaStars"></span>
                                <button id="followMangaBtn" class="follow-manga-btn">
                                    <span class="follow-icon">‚ù§Ô∏è</span>
                                    <span class="follow-text">Follow</span>
                                </button>
                            </div>
                        </div>
                        <div class="manga-info-section">
                            <h1 id="mangaDetailsTitle" class="manga-details-title"></h1>
                            <div class="manga-metadata">
                                <div class="metadata-item">
                                    <span class="metadata-label">Alternative Names:</span>
                                    <div id="mangaAltNames" class="metadata-value alt-names"></div>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Chapters:</span>
                                    <span id="mangaChapterCount" class="metadata-value">Loading...</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Status:</span>
                                    <span id="mangaStatus" class="metadata-value">Unknown</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Year:</span>
                                    <span id="mangaYear" class="metadata-value">Unknown</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Country:</span>
                                    <span id="mangaCountry" class="metadata-value">Unknown</span>
                                </div>
                            </div>
                            <div class="manga-description">
                                <h3>Description</h3>
                                <p id="mangaDescription" class="description-text"></p>
                            </div>
                        </div>
                    </div>

                    <div class="manga-tags-section">
                        <div class="tags-group">
                            <h3>Genres</h3>
                            <div id="mangaGenres" class="tags-container"></div>
                        </div>
                        <div class="tags-group">
                            <h3>Categories</h3>
                            <div id="mangaCategories" class="tags-container"></div>
                        </div>
                    </div>

                    <div class="manga-sources-section">
                        <div class="sources-header">
                            <h3>Available Sources</h3>
                            <button id="refreshSources" class="refresh-sources-btn"
                                title="Refresh sources (clears cache)">üîÑ</button>
                        </div>
                        <p class="sources-subtitle">Choose where to read this manga:</p>
                        <div id="mangaSources" class="sources-grid loading">
                            <div class="loading-message">üîç Finding available sources...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sourceSelection" class="source-selection hidden">
                <button id="backToHome" class="back-btn">‚Üê Back to Home</button>
                <h2 id="sourceSelectionTitle"></h2>
                <p class="source-selection-subtitle">Choose a source to read from:</p>
                <div id="sourcesGrid" class="sources-grid"></div>
            </div>

            <div id="chapterList" class="chapter-list hidden">
                <button id="backToSourceSelection" class="back-btn">‚Üê Back to Details</button>
                <h2 id="mangaTitle"></h2>
                <div id="chaptersGrid" class="chapters-grid"></div>
            </div>

            <div id="followsPage" class="follows-page hidden">
                <button id="backFromFollows" class="back-btn">‚Üê Back</button>
                <div class="follows-header">
                    <h2>Following</h2>
                    <div class="follows-actions">
                        <button id="checkUpdatesBtn" class="import-export-btn check-updates-btn">üîÑ Check for
                            Updates</button>
                        <button id="fetchCoversBtn" class="import-export-btn fetch-covers-btn">üñºÔ∏è Fetch All
                            Covers</button>
                        <button id="updateReadingProgressBtn" class="import-export-btn">üìñ Add Continue Buttons</button>
                        <button id="importFollowsBtn" class="import-export-btn">üì• Import CSV</button>
                        <button id="exportFollowsBtn" class="import-export-btn">üì§ Export CSV</button>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="follows-controls">
                    <div class="search-filter-container">
                        <input type="text" id="followsSearchInput" placeholder="Search manga..." class="follows-search">
                        <select id="statusFilter" class="status-filter">
                            <option value="">All Statuses</option>
                            <option value="Reading">Reading</option>
                            <option value="Completed">Completed</option>
                            <option value="On-Hold">On-Hold</option>
                            <option value="Dropped">Dropped</option>
                            <option value="Plan to Read">Plan to Read</option>
                        </select>
                        <button id="clearFiltersBtn" class="clear-filters-btn">Clear</button>
                    </div>
                </div>

                <div id="followsGrid" class="follows-grid"></div>

                <!-- Hidden file input for CSV import -->
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
            </div>

            <div id="notificationsPage" class="notifications-page hidden">
                <button id="backFromNotifications" class="back-btn">‚Üê Back</button>
                <div class="notifications-header">
                    <h2>Notifications</h2>
                    <div class="notifications-actions">
                        <button id="markAllReadBtn" class="mark-all-read-btn">Mark All Read</button>
                        <button id="clearAllNotificationsBtn" class="clear-all-notifications-btn">Clear All</button>
                    </div>
                </div>
                <div id="notificationsList" class="notifications-list"></div>
            </div>

            <div id="settingsPage" class="settings-page hidden">
                <button id="backFromSettings" class="back-btn">‚Üê Back</button>
                <div class="settings-header">
                    <h2>Search Sources</h2>
                    <p class="settings-description">Select which sources to use for manga search. Comick is recommended
                        as the primary source.</p>
                </div>
                <div id="sourceSettings" class="source-grid">
                    <div class="loading">Loading sources...</div>
                </div>
                <div class="settings-actions">
                    <button id="selectAllSources" class="settings-btn">Select All</button>
                    <button id="deselectAllSources" class="settings-btn">Deselect All</button>
                    <button id="resetToDefault" class="settings-btn primary">Reset to Default</button>
                </div>
            </div>



            <div id="reader" class="reader hidden">

                <div class="reader-controls reader-controls-top">
                    <button id="backFromReader" class="back-btn">‚Üê Back</button>
                    <span id="pageInfo"></span>
                    <div class="chapter-navigation">
                        <button id="prevChapter">‚Üê Previous Chapter</button>
                        <select id="chapterSelect"></select>
                        <button id="nextChapter">Next Chapter ‚Üí</button>
                    </div>
                </div>
                <div id="pageContainer" class="page-container"></div>
                <div class="reader-controls reader-controls-bottom">
                    <span id="pageInfoBottom"></span>
                    <div class="chapter-navigation">
                        <button id="prevChapterBottom">‚Üê Previous Chapter</button>
                        <select id="chapterSelectBottom"></select>
                        <button id="nextChapterBottom">Next Chapter ‚Üí</button>
                    </div>
                </div>


            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <footer class="bottom-nav">
            <div class="bottom-nav-content">
                <h1 id="bottomHomeTitle" class="clickable-title">Vash Reader</h1>
                <div class="bottom-nav-buttons">
                    <button id="bottomFollowsBtn" class="header-btn">Following</button>
                    <button id="bottomNotificationsBtn" class="header-btn notification-btn">
                        üîî
                        <span id="bottomNotificationBadge" class="notification-badge hidden">0</span>
                    </button>
                    <button id="bottomSettingsBtn" class="header-btn" title="Settings">‚öôÔ∏è</button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Reader Navigation Menu (outside .app to avoid zoom scaling) -->
    <div id="readerNavMenu" class="reader-nav-menu">
        <button id="readerNavToggle" class="reader-nav-toggle" title="Navigation Menu">
            <span class="nav-arrow">‚ñ∂</span>
        </button>
        <div id="readerNavContent" class="reader-nav-content">
            <div class="nav-menu-header">
                <h3>Navigation</h3>
            </div>
            <div class="nav-menu-items">
                <button id="navHomeBtn" class="nav-menu-item">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Vash Reader</span>
                </button>
                <button id="navPrevChapterBtn" class="nav-menu-item">
                    <span class="nav-icon">‚¨ÖÔ∏è</span>
                    <span class="nav-text">Previous Chapter</span>
                </button>
                <div class="nav-menu-item nav-chapter-select">
                    <span class="nav-icon">üìã</span>
                    <select id="navChapterSelect" class="nav-chapter-dropdown">
                        <option value="">Chapter List</option>
                    </select>
                </div>
                <button id="navNextChapterBtn" class="nav-menu-item">
                    <span class="nav-icon">‚û°Ô∏è</span>
                    <span class="nav-text">Next Chapter</span>
                </button>
                <div class="nav-menu-divider"></div>
                <button id="navFollowsBtn" class="nav-menu-item">
                    <span class="nav-icon">üìö</span>
                    <span class="nav-text">Following</span>
                </button>
                <button id="navNotificationsBtn" class="nav-menu-item">
                    <span class="nav-icon">üîî</span>
                    <span class="nav-text">Notifications</span>
                    <span id="navNotificationBadge" class="nav-notification-badge hidden">0</span>
                </button>
                <button id="navSettingsBtn" class="nav-menu-item">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Search Sources</h2>
                <button id="closeSettings" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <p class="settings-description">Select which sources to use for manga search. Comick is recommended as
                    the primary source.</p>
                <div id="sourceSettings" class="source-settings-grid">
                    <div class="loading">Loading sources...</div>
                </div>
                <div class="settings-actions">
                    <button id="selectAllSources" class="settings-btn">Select All</button>
                    <button id="deselectAllSources" class="settings-btn">Deselect All</button>
                    <button id="resetToDefault" class="settings-btn primary">Reset to Default</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div id="advancedSearchModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Advanced Search</h2>
                <button id="closeAdvancedSearch" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <form id="advancedSearchForm">
                    <!-- Basic Search -->
                    <div class="form-group">
                        <label for="advancedQuery">Title Search:</label>
                        <input type="text" id="advancedQuery" placeholder="Enter manga title...">
                    </div>

                    <!-- Type/Format -->
                    <div class="form-group">
                        <label>Type:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="type" value="manga"> Manga</label>
                            <label><input type="checkbox" name="type" value="manhwa"> Manhwa</label>
                            <label><input type="checkbox" name="type" value="manhua"> Manhua</label>
                        </div>
                    </div>

                    <!-- Demographics -->
                    <div class="form-group">
                        <label>Demographics:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="demographic" value="1"> Shounen</label>
                            <label><input type="checkbox" name="demographic" value="2"> Shoujo</label>
                            <label><input type="checkbox" name="demographic" value="3"> Seinen</label>
                            <label><input type="checkbox" name="demographic" value="4"> Josei</label>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="form-group">
                        <label for="status">Status:</label>
                        <select id="status">
                            <option value="">Any</option>
                            <option value="1">Ongoing</option>
                            <option value="2">Completed</option>
                            <option value="3">Cancelled</option>
                            <option value="4">Hiatus</option>
                        </select>
                    </div>

                    <!-- Content Rating -->
                    <div class="form-group">
                        <label>Content Rating:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="contentRating" value="safe"> Safe</label>
                            <label><input type="checkbox" name="contentRating" value="suggestive"> Suggestive</label>
                            <label><input type="checkbox" name="contentRating" value="erotica"> Erotica</label>
                        </div>
                    </div>

                    <!-- Country -->
                    <div class="form-group">
                        <label>Country:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="country" value="jp"> Japan</label>
                            <label><input type="checkbox" name="country" value="kr"> Korea</label>
                            <label><input type="checkbox" name="country" value="cn"> China</label>
                        </div>
                    </div>

                    <!-- Year Range -->
                    <div class="form-group">
                        <label>Year Range:</label>
                        <div class="year-range">
                            <input type="number" id="fromYear" placeholder="From" min="1900" max="2030">
                            <span>to</span>
                            <input type="number" id="toYear" placeholder="To" min="1900" max="2030">
                        </div>
                    </div>

                    <!-- Minimum Chapters -->
                    <div class="form-group">
                        <label for="minChapters">Minimum Chapters:</label>
                        <input type="number" id="minChapters" min="0" placeholder="0">
                    </div>

                    <!-- Genres -->
                    <div class="form-group">
                        <label>Genres (Include):</label>
                        <input type="text" id="genreSearch" class="genre-search" placeholder="üîç Search genres...">
                        <div id="genresContainer" class="genres-container">
                            <div class="loading">Loading genres...</div>
                        </div>
                    </div>

                    <!-- Excluded Genres -->
                    <div class="form-group">
                        <label>Exclude Genres:</label>
                        <input type="text" id="excludedGenreSearch" class="genre-search"
                            placeholder="üîç Search genres to exclude...">
                        <div id="excludedGenresContainer" class="genres-container">
                            <div class="loading">Loading genres...</div>
                        </div>
                    </div>

                    <!-- Sort -->
                    <div class="form-group">
                        <label for="sort">Sort by:</label>
                        <select id="sort">
                            <option value="">Relevance</option>
                            <option value="rating">Rating</option>
                            <option value="follow">Most Followed</option>
                            <option value="view">Most Viewed</option>
                            <option value="created_at">Newest</option>
                            <option value="uploaded">Recently Updated</option>
                        </select>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="button" id="clearAdvancedSearch">Clear All</button>
                        <button type="submit" id="submitAdvancedSearch">Search</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div id="loadingText" class="loading-text">Loading...</div>
        </div>
    </div>

    <script src="../utils/content-filter.js"></script>
    <script src="../utils/zoom-handler.js"></script>
    <script src="../utils/search-utils.js"></script>
    <script src="renderer.js"></script>
</body>

</html>